# Дизайн ML системы - Оптимизация А/Б тестирования с помощью машинного обучения

## 1. Цели и предпосылки

### 1.1. Зачем идем в разработку продукта?

Сегодня А/Б тестирование - это основной метод научного доказательства влияния изменений в продукте на метрики, который повсеместно используется. Тем не менее, А/Б тестирование часто либо невозможно, либо недостаточно данных для проведения теста, либо для достижения заданного уровня значимости и мощности тест длится слишком долго. Таким образом, цели данного проект:

- **Бизнес-цель:** С помощью машинного обучения можно уменьшить дисперсию теста, тем самым ускоряя его и решая проблему маленьких выборок, а также провести аналог А/Б теста там, где разбиение на группы невозможно (синтетический контроль и прогнозирование). Ускоряя тесты, мы помогаем бизнесу проводить больше тестов, а чем больше тестов мы можем провести, тем больше шанс найти гипотезы, которые улучшат целевые метрики и приведут к росту прибыли.
  
- **Почему станет лучше, чем сейчас, от использования ML:** Машинное обучение либо улучшает существующие методы (CUPED) оптимизации экспериментов, либо предлагает принципиально новые методы (синтетический контроль), которые невозможны без ML.

- **Что будем считать успехом итерации с точки зрения бизнеса:** работающий сервис по применению ML в экспериментах, доказанная эффективность (уменьшения доверительного интервала относительно классических критериев и CUPED) предложенных ML методах на синтетических (смоделированных) данных и доступных датасетах, готовый отчет по проекту.

### 1.2. Бизнес-требования и ограничения

**Целевое решение:** сервис по применению машинного обучения для оптимизации и проведения АБ-тестов.


## Логика работы

1. В веб-интерфейсе пользователь выбирает, что необходимо сделать - провести тест с синтетическим контролем или уменьшить дисперсию текущего теста.
2. Загружает данные в веб-интерфейс.
3. Сервис обучает модель, подбирает гиперпараметры, рассчитывает статистические критерии.
4. Пользователю выводится результат - анализ А/Б теста после применения ML.

## Бизнес-ограничения

- Сервис на первой итерации работает с поюзерными тестами с непрерывными целевыми метриками.
- Уменьшение дисперсии зависит от предсказательной силы модели для данных пользователя и не всегда будет приводить к существенному сокращению дисперсии.
- Для корректной работы синтетического контроля метрика должна представлять из себя стационарный временной ряд, чтобы прогноз модели был адекватен.
- Не предполагает использования для A/B/C/n тестирования.
- Модель должна отрабатывать за ограниченное кол-во времени (не дольше 10 минут).

## Критерии успеха

- Доказанная эффективность (уменьшения доверительного интервала относительно классических критериев и CUPED) предложенных ML методах на синтетических (смоделированных) данных и доступных датасетах.

### 1.3. Что входит в скоуп проекта/итерации, что не входит

- **На закрытие каких БТ подписываемся в данной итерации:** реализация веб-интерфейса, мл-составляющая, аналитическая составляющая, визуализация.
  
- **Результат с точки зрения качества кода и воспроизводимости решения:** Отдельный репозиторий с приложением streamlit и fast-api. Используется модульный подход, где каждый модуль отвечает за свою часть – предобработка данных, моделирование, визуализация и т.д.
  
- **Описание планируемого технического долга (что оставляем для дальнейшей продуктивизации):** Добавить логирование, авторизацию пользователей, потоковая обработка данных с экспериментов, отдельное API с реализованными методами.


### 1.4. Предпосылки решения

Данные методы известны, но отсутствует понятная реализация, которая позволила бы компаниям и получать качественный результат с применением ML без очень глубокой экспертизы в данной области.

## 2. Методология 

### 2.1. Постановка задачи

Аналитическая и ML часть проекта будут состоять из следующих компонент:

- Увеличение чувствительности тестов с помощью ML - реализация CUPED, CUPAC, CUNOPAC, автоматизация обучения модели и выбор наиболее подходящего метода сокращения дисперсии.
- Проведение тестов без возможности разделения на тест и контроль - синтетический контроль в виде ML-прогноза целевой метрики на основе исторических данных.

### 2.2. Блок-схема решения

### 2.3. Этапы решения задачи 

1. Подготовка датасетов для обучения моделей, написание скрипта для моделирования синтетических данных.
2. Реализация автоматизированного обучения ML моделей для уменьшения чувствительности.
3. Реализация автоматизированного обучения ML моделей для прогнозирования метрик для синтетического контроля.
4. Реализация аналитической составляющей по анализу А/Б тестов - расчет p-value, доверительных интервалов и т. д.
5. Подготовка инференса моделей и расчета аналитики для тестов.
6. Реализация веб-интерфейса для загрузки данных.
7. Интеграция написанного сервиса для обучения моделей в веб-сервис.
8. Реализация визуализации результатов в веб интерфейсе.
9. Подготовка финального отчета.

## 3. Подготовка пилота

### 3.1. Способ оценки пилота

### 3.2. Что считаем успешным пилотом

### 3.3. Подготовка пилота

## 4. Внедрение 

### 4.1. Архитектура решения

### 4.2. Описание инфраструктуры и масштабируемости

### 4.3. Требования к работе системы

### 4.4. Безопасность системы

### 4.5. Безопасность данных

### 4.6. Издержки

### 4.5. Integration points

### 4.6. Риски
